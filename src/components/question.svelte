<script>
    import { onMount } from "svelte";   
    import { answers } from "/src/stores";
    export let q;
    
    let isCorrect = false;
    let showIncorrect = false;

    onMount(async () => {
	    await doPost(q.Id, $answers[q.Id-1]);
    });

    async function checkAnswer(id, answer){
        await doPost(id, answer);
        if(!isCorrect){
            showIncorrect = true;
            setTimeout(function(){
                showIncorrect = false;
            }, 2000);
        }
    }
   
    async function doPost (id, answer) {
		const res = await fetch('/api/answer', {
			method: 'POST',
			body: JSON.stringify({
				id, answer
			})
		});
		
		var data = await res.json();
        isCorrect = data.valid;
	}
</script>

<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
    <div class="card-body p-2 {isCorrect == true ? "correct" : showIncorrect == true ? "incorrect" : ""}">
        <p>{q.Question}</p>
        <form id="form{q.Id}">
            <input type="text" placeholder="Insert Flag Here" class="input input-bordered input-sm w-full max-w-xs" bind:value={$answers[q.Id-1]} />
        </form>
        <div class="card-actions justify-end">
            <label for="modalHint{q.Id}" class="btn btn-xs modal-button">Hint</label>
            <button class="btn btn-xs bg-success-content" type="button" on:click={() => checkAnswer(q.Id, $answers[q.Id-1])}>Check Answer</button>
        </div>
    </div>
</div>

<input type="checkbox" id="modalHint{q.Id}" class="modal-toggle" />
<div class="modal">
    <div class="modal-box p-3">
        <h3 class="font-bold text-lg reset-font">Hint:</h3>
        <p class="py-4">
            {q.Hint}
        </p>
        <div class="modal-action">
            <label for="modalHint{q.Id}" class="btn btn-sm">Close</label>
        </div>
    </div>
</div>