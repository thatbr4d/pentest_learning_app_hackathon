import * as cookie from "cookie";

/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
    if (event.url.pathname.startsWith('/app/dev/notes')) {
        if(event.request.method !== "POST")
           return new Response('Not Authorized');
    }

    if(event.url.pathname.startsWith('/app/admin') && event.url.pathname !== '/app/admin/login'){
      console.log(event.url.pathname);
      const cookies = cookie.parse(event.request.headers.get("cookie") || "");
      if(cookies.session){
        const {id, isOwner} = JSON.parse(cookies.session);
        if(id !== 'adminsession123456789')
          return Response.redirect(event.url.origin + '/app/admin/login');
        
      }else{
        return Response.redirect(event.url.origin + '/app/admin/login');
      }
    }

    const response = await resolve(event);
    return response;
}