<script>
import { onMount } from "svelte";
import { goto } from "$app/navigation";

let appSession;
let mounted = false;
let username = '';

export let flags;
export let SessionName;

onMount(async () => {
	appSession = await getSession();
	mounted = true;
});

async function getSession(){
	return await penTestDb
					.get(SessionName)
					.then(function (doc) {
						return doc;
					}).catch(function (err) {
						return false;
					});
}

async function createSession(){
	const tmp = {
		_id: SessionName,
		User: username,
		Flags: [
			flags
		]
	}

	await penTestDb.put(tmp);
	goto('/app', {replaceState:true});
}

async function deleteSession(){
	await penTestDb.get(SessionName).then(function(doc) {
  		penTestDb.remove(doc);
	});
	appSession = false;
}

</script>

<svelte:head>
	<title>Cyber Trainer</title>
</svelte:head>

<h1>Cyber Trainer</h1>

{#if appSession && mounted}
	<div>Hello {appSession.User}</div>
	<a href="/app" class="btn">Continue</a>
	<button class="btn btn-secondary" on:click={async (e) => deleteSession()}>Start Over</button>
{:else if mounted}
	<input type="text" placeholder="Enter Your Name" bind:value={username}/>
	<button class="btn" on:click={async (e) => createSession()} disabled={(!username || /^\s*$/.test(username))}>Begin</button>
{:else}
	<div></div>
{/if}



