<script context="module">
	/** @type {import('./__types/[slug]').Load} */
	export async function load({ fetch }) {
		const res = await fetch('/api/questions');

		return {
			status: res.status,
			props: {
				data: res.ok && (await res.json())
			}
		};
	}
</script>

<script>
	import '$lib/global.css';
	import { onMount } from "svelte";

	onMount(async () => {
		let xterm = (await import('$lib/js/terminal.js'));
		xterm.default();
	});

	export let data;
	let questions = data.questionsFiltered;
</script>

<div class="grid grid-cols-12 h-screen">
	<!-- Questions Section -->
	<div class="bg-base-200 col-start-1 col-end-4 p-2 sidebar overflow-auto z-50">
		{#each questions as q}
			<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
				<div class="card-body p-2">
					<p>{q.Question}</p>
					<form id="form{q.Id}">
						<input type="text" placeholder="Insert Flag Here" class="input input-bordered input-sm w-full max-w-xs" />
					</form>
					<div class="card-actions justify-end">
						<label for="modalHint{q.Id}" class="btn btn-xs modal-button">Hint</label>
						<button class="btn btn-xs bg-success-content">Check Answer</button>
					</div>
				</div>
			</div>

			<input type="checkbox" id="modalHint{q.Id}" class="modal-toggle" />
			<div class="modal">
				<div class="modal-box p-3">
					<h3 class="font-bold text-lg reset-font">Hint:</h3>
					<p class="py-4">{q.Hint}</p>
					<div class="modal-action">
						<label for="modalHint{q.Id}" class="btn btn-sm">Close</label>
					</div>
				</div>
			</div>
		{/each}
	</div>

	<!-- Main Section -->
	<div class="col-start-4 col-end-13 relative">
		<div class="navbar custom-navbar">
			<div class="nav-cover">
				<!-- Logout -->
				<button class="btn btn-sm custom-navbar-button logout">
					Logout
				</button>
			</div>
			<div class="logo invisible md:visible"></div>
			<div class="logo sm visible md:invisible"></div>
		</div>
		
		<!-- Terminal -->
		<div class="collapse absolute top-1 left-1">
			<input type="checkbox" class="min-h-0" />
			<div class="collapse-title min-h-0">
				<button class="btn btn-sm custom-navbar-button pl-2">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-0dot75" viewBox="0 0 20 20" fill="currentColor">
						<path fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" clip-rule="evenodd" />
					</svg> Terminal&nbsp;<span class="font-normal pointer-events-none">(</span><small class="relative mt-0.5 font-normal pointer-events-none">Show/Hide</small><span class="font-normal pointer-events-none">)</span></button>
			</div>
			<div class="collapse-content">
				<div class="card card-compact shadow text-primary-content terminal-wrapper">
					<div id="terminal"></div>
				</div>
			</div>
		</div>
		
		<!-- Content for main -->
		<div class="fake-site-outer-wrapper">
			<div class="fake-site-inner-wrapper">
				<ul class="menu menu-horizontal bg-base-100 w-full justify-between toystore-menu reset-font">
					<li>
						<a class="gap-1" href="/app">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
							</svg>Home</a>
					</li>
					<li>
						<a class="gap-1" href="/app/shop">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
							</svg>
							Shop By Category</a>
					</li>
					<li>
						<a class="gap-1" href="/app/contact">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
							</svg>Contact</a>
					</li>
					<li>
						<a class="gap-1" href="/app/cart">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
							</svg>Cart
						</a>
					</li>
					<li>
						<a class="gap-1" href="/app/user">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
							</svg>Profile
						</a>
					</li>

					<li class="searchbox">
						<div class="form-control">
							<div class="input-group">
								<input type="text" placeholder="Search…" class="input input-bordered input-xs no-outline" />
								<button class="btn btn-square btn-xs">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
									</svg>
								</button>
							</div>
						</div>
					</li>
				</ul>
				<div class="p-2">
					<slot />
				</div>				
			</div>
		</div>
		
	</div>
</div>









<!-- Temporary for reference, delete later -->
<!-- Question1 Card -->
		<!--
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Which element in the dom exposes the user's password?</p>
				<form id="formQ1">
					 	<input type="radio" id="UserPassword" name="radio1" value="UserPassword" class="radio-xs" /> <label for="UserPassword" class="text-sm">#UserPassword</label><br />
					 	<input type="radio" id="RoleUser" name="radio1" value="RoleUser" class="radio-xs" /> <label for="RoleUser" class="text-sm">#RoleUser</label><br />
					 	<input type="radio" id="InputPW" name="radio1" value="InputPW" class="radio-xs" /> <label for="InputPW" class="text-sm">#InputPW</label>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint1" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question2 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>What is a search term that would break the site?</p>
				<form id="formQ2">
					<input type="text" placeholder="Type answer here" class="input input-bordered input-sm w-full max-w-xs" />
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint2" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question3 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Which JavaScript function exposes a list of residential addresses?</p>
				<form id="formQ3">
					 	<input type="radio" id="CreateUserList" name="radio2" value="CreateUserList" class="radio-xs" /> <label for="CreateUserList" class="text-sm">CreateUserList()</label><br />
					 	<input type="radio" id="GetAddresses" name="radio2" value="GetAddresses" class="radio-xs" /> <label for="GetAddresses" class="text-sm">GetAddresses()</label><br />
					 	<input type="radio" id="AddUserProfile" name="radio2" value="AddUserProfile" class="radio-xs" /> <label for="AddUserProfile" class="text-sm">AddUserProfile()</label>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint3" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question4 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Check all security vulnerabilities caused by the site's search input?</p>
				<form id="formQ4">
					<div class="form-control">
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">Cross-site Scripting</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">SQL Injection</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">Unrestricted File Uploads</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">OS Command Injection</span>
						</label>
					</div>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint4" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
	</div>

<!-- Modal Hint for Q1
<input type="checkbox" id="modalHint1" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">The password is exposed in a data attribute.</p>
		<div class="modal-action">
			<label for="modalHint1" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q2
<input type="checkbox" id="modalHint2" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">Any term using a certain symbol will cause the site to break.</p>
		<div class="modal-action">
			<label for="modalHint2" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q3
<input type="checkbox" id="modalHint3" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">Check all externally loaded script files. Don't just look at the code, but also inspect the comments.</p>
		<div class="modal-action">
			<label for="modalHint3" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q4
<input type="checkbox" id="modalHint4" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">You can check each vulnerability by running command checks in the terminal.</p>
		<div class="modal-action">
			<label for="modalHint4" class="btn btn-sm">Close</label>
		</div>
	</div>
</div> -->
