<script context="module">
	/** @type {import('./__types/[slug]').Load} */
	export async function load({ fetch }) {
		const res = await fetch('/api/questions');

		return {
			status: res.status,
			props: {
				data: res.ok && (await res.json())
			}
		};
	}
</script>

<script>
	import '$lib/global.css';
	import { onMount } from "svelte";

	onMount(async () => {
		let xterm = (await import('$lib/js/terminal.js'));
		xterm.default();
	});

	export let data;
	let questions = data.questionsFiltered;
</script>

<div class="grid grid-cols-12 h-screen">
	<!-- Questions Section -->
	<div class="bg-base-200 col-start-1 col-end-4 p-2 sidebar overflow-auto z-50">
		{#each questions as q}
			<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
				<div class="card-body p-2">
					<p>{q.Question}</p>
					<form id="form{q.Id}">
						<input type="text" placeholder="Insert Flag Here" class="input input-bordered input-sm w-full max-w-xs" />
					</form>
					<div class="card-actions justify-end">
						<label for="modalHint{q.Id}" class="btn btn-xs modal-button">Hint</label>
						<button class="btn btn-xs bg-success-content">Check Answer</button>
					</div>
				</div>
			</div>

			<input type="checkbox" id="modalHint{q.Id}" class="modal-toggle" />
			<div class="modal">
				<div class="modal-box p-3">
					<h3 class="font-bold text-lg reset-font">Hint:</h3>
					<p class="py-4">{q.Hint}</p>
					<div class="modal-action">
						<label for="modalHint{q.Id}" class="btn btn-sm">Close</label>
					</div>
				</div>
			</div>
		{/each}
	</div>

	<!-- Main Section -->
	<div class="col-start-4 col-end-13 relative">
		<div class="navbar custom-navbar">
			<div class="nav-cover">
				<!-- Logout -->
				<button class="btn btn-sm custom-navbar-button logout">
					Logout
				</button>
			</div>
			<div class="logo invisible md:visible"></div>
			<div class="logo sm visible md:invisible"></div>
		</div>
		
		<!-- Terminal -->
		<div class="collapse absolute top-1 left-1">
			<input type="checkbox" class="min-h-0" />
			<div class="collapse-title min-h-0">
				<button class="btn btn-sm custom-navbar-button">Terminal&nbsp;<span class="font-normal pointer-events-none">(</span><small class="relative mt-0.5 font-normal pointer-events-none">Show/Hide</small><span class="font-normal pointer-events-none">)</span></button>
			</div>
			<div class="collapse-content">
				<div class="card card-compact shadow text-primary-content terminal-wrapper">
					<div id="terminal"></div>
				</div>
			</div>
		</div>
		
		<!-- Content for main -->
		<div class="px-2 py-1">
			<ul class="menu menu-horizontal bg-base-100">
				<li><a href="/app">Home</a></li>
				<li><a href="/app/admin">Admin</a></li>
			</ul>

			<div>
				<slot />
			</div>
		</div>
		
	</div>
</div>









<!-- Temporary for reference, delete later -->
<!-- Question1 Card -->
		<!--
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Which element in the dom exposes the user's password?</p>
				<form id="formQ1">
					 	<input type="radio" id="UserPassword" name="radio1" value="UserPassword" class="radio-xs" /> <label for="UserPassword" class="text-sm">#UserPassword</label><br />
					 	<input type="radio" id="RoleUser" name="radio1" value="RoleUser" class="radio-xs" /> <label for="RoleUser" class="text-sm">#RoleUser</label><br />
					 	<input type="radio" id="InputPW" name="radio1" value="InputPW" class="radio-xs" /> <label for="InputPW" class="text-sm">#InputPW</label>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint1" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question2 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>What is a search term that would break the site?</p>
				<form id="formQ2">
					<input type="text" placeholder="Type answer here" class="input input-bordered input-sm w-full max-w-xs" />
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint2" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question3 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Which JavaScript function exposes a list of residential addresses?</p>
				<form id="formQ3">
					 	<input type="radio" id="CreateUserList" name="radio2" value="CreateUserList" class="radio-xs" /> <label for="CreateUserList" class="text-sm">CreateUserList()</label><br />
					 	<input type="radio" id="GetAddresses" name="radio2" value="GetAddresses" class="radio-xs" /> <label for="GetAddresses" class="text-sm">GetAddresses()</label><br />
					 	<input type="radio" id="AddUserProfile" name="radio2" value="AddUserProfile" class="radio-xs" /> <label for="AddUserProfile" class="text-sm">AddUserProfile()</label>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint3" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
		<!-- Question4 Card 
		<div class="card w-auto bg-base-100 shadow-xl mb-2.5">
			<div class="card-body p-2">
				<p>Check all security vulnerabilities caused by the site's search input?</p>
				<form id="formQ4">
					<div class="form-control">
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">Cross-site Scripting</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">SQL Injection</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">Unrestricted File Uploads</span>
						</label>
						<label class="label justify-start cursor-pointer">
							<input type="checkbox" class="checkbox checkbox-sm" />
							<span class="label-text ml-1.5">OS Command Injection</span>
						</label>
					</div>
				</form>
				<div class="card-actions justify-end">
					<label for="modalHint4" class="btn btn-xs modal-button">Hint</label>
					<button class="btn btn-xs bg-success-content">Check Answer</button>
				</div>
			</div>
		</div>
	</div>

<!-- Modal Hint for Q1
<input type="checkbox" id="modalHint1" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">The password is exposed in a data attribute.</p>
		<div class="modal-action">
			<label for="modalHint1" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q2
<input type="checkbox" id="modalHint2" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">Any term using a certain symbol will cause the site to break.</p>
		<div class="modal-action">
			<label for="modalHint2" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q3
<input type="checkbox" id="modalHint3" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">Check all externally loaded script files. Don't just look at the code, but also inspect the comments.</p>
		<div class="modal-action">
			<label for="modalHint3" class="btn btn-sm">Close</label>
		</div>
	</div>
</div>
<!-- Modal Hint for Q4
<input type="checkbox" id="modalHint4" class="modal-toggle" />
<div class="modal">
	<div class="modal-box p-3">
		<h3 class="font-bold text-lg reset-font">Hint:</h3>
		<p class="py-4">You can check each vulnerability by running command checks in the terminal.</p>
		<div class="modal-action">
			<label for="modalHint4" class="btn btn-sm">Close</label>
		</div>
	</div>
</div> -->
